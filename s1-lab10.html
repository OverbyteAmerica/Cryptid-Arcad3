<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DEFENDERS ‚Äî Lab 10: Season Finale</title>
<style>
*,*::before,*::after{box-sizing:border-box;}
body{background-color:#000;color:#00ffcc;font-family:'Courier New',Courier,monospace;font-size:16px;line-height:1.4;margin:0;padding:20px;overflow-x:hidden;}
h1,h2,h3,h4{font-family:'Courier New',Courier,monospace;color:#00ffcc;margin:0 0 12px 0;}
h1{font-size:2rem;}h2{font-size:1.6rem;}h3{font-size:1.3rem;}
a{color:#00ffcc;text-decoration:none;}a:hover{text-decoration:underline;}
.hidden{display:none;}.center{text-align:center;}
.panel{border:1px solid #00ffcc;padding:18px;margin:20px 0;background-color:rgba(0,0,0,0.85);border-radius:6px;box-shadow:0 0 12px rgba(0,255,204,0.4);}
button{background-color:#000;border:1px solid #00ffcc;color:#00ffcc;padding:10px 16px;cursor:pointer;font-family:monospace;font-size:0.95rem;border-radius:4px;transition:all 0.2s ease;display:inline-block;}
button:hover{background-color:#002;box-shadow:0 0 8px #00ffcc;}
button:disabled{opacity:0.4;cursor:not-allowed;}
#cookie{position:fixed;top:20px;right:20px;width:240px;border:1px solid #00ffcc;background:#000;padding:12px;box-shadow:0 0 18px rgba(0,255,204,.5);font-size:0.9rem;z-index:9999;border-radius:8px;}
#cookie-avatar{font-size:1.6rem;margin-bottom:6px;}
#cookie-text{opacity:0.95;line-height:1.4;}
#cookie::before{content:"";position:absolute;inset:0;background:linear-gradient(rgba(0,255,204,0.05),transparent);pointer-events:none;}
.boot{font-size:1.1rem;margin-bottom:20px;white-space:pre-wrap;word-break:break-word;min-height:60px;}
.typing-cursor::after{content:"_";animation:blink 1s step-end infinite;}
@keyframes blink{from,to{opacity:0;}50%{opacity:1;}}
.log{background-color:#001;border:1px solid #00ffcc;padding:12px;margin-top:20px;height:220px;overflow-y:auto;font-size:0.85rem;border-radius:4px;box-shadow:0 0 10px rgba(0,255,204,0.3);}
.log p{margin:3px 0;}.warn{color:#ffaa00;}.danger{color:#ff4444;}.success{color:#00ffcc;}.info{color:#888;}
#pb-outer{background:rgba(0,255,204,0.1);border:1px solid #00ffcc44;border-radius:4px;height:8px;margin:10px 0 20px;overflow:hidden;}
#pb{height:100%;background:#00ffcc;width:0%;transition:width 0.5s ease;box-shadow:0 0 8px #00ffcc;}

/* ASHER SIGNAL ‚Äî BOSS BAR */
#asher-wrap{margin:10px 0;}
#asher-label-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;flex-wrap:wrap;gap:8px;}
#asher-name{font-size:1rem;color:#ff4444;letter-spacing:2px;}
#asher-signal-pct{font-size:0.9rem;color:#ff4444;}
#asher-outer{background:rgba(255,68,68,0.1);border:1px solid rgba(255,68,68,0.4);border-radius:4px;height:20px;overflow:hidden;position:relative;}
#asher-bar{height:100%;width:100%;background:linear-gradient(90deg,#cc0000,#ff4444,#ff8800);transition:width 1.2s ease;box-shadow:0 0 14px rgba(255,68,68,0.5);}
#asher-bar.flicker{animation:ashflicker 0.6s infinite;}
#asher-bar.critical{background:linear-gradient(90deg,#440000,#ff2200);animation:ashflicker 0.3s infinite;}
@keyframes ashflicker{0%,100%{opacity:1;}50%{opacity:0.4;}}
#asher-status{font-size:0.78rem;color:#ff4444;margin-top:5px;min-height:18px;letter-spacing:1px;}

/* VAULT INTEGRITY */
#vi-outer{background:rgba(0,255,204,0.1);border:1px solid #00ffcc44;border-radius:4px;height:12px;margin:6px 0;overflow:hidden;}
#vi-bar{height:100%;background:#00ffcc;width:85%;transition:width 0.6s ease;box-shadow:0 0 6px #00ffcc;}
#vi-bar.low{background:#ff4444;box-shadow:0 0 6px #ff4444;}
#vi-bar.mid{background:#ffaa00;}

/* NARRATIVE CALLOUT */
.story-beat{background:rgba(0,255,204,0.03);border-left:3px solid #00ffcc44;border-radius:0 4px 4px 0;padding:12px 16px;margin:14px 0;font-size:0.88rem;line-height:1.7;color:#00ffccc0;}
.story-beat em{color:#ffaa00;font-style:normal;}

/* OPTION CARDS */
.opt-card{border:1px solid rgba(0,255,204,0.22);border-radius:4px;padding:14px;margin:8px 0;cursor:pointer;transition:all 0.2s;font-size:0.85rem;}
.opt-card:hover{background:rgba(0,255,204,0.03);border-color:#00ffcc55;}
.opt-card h4{margin:0 0 5px;font-size:0.88rem;}
.opt-card p{margin:0;opacity:0.65;font-size:0.8rem;line-height:1.5;}
.opt-card.chosen-right{border-color:#00ffcc;background:rgba(0,255,204,0.04);}
.opt-card.chosen-wrong{border-color:#ff4444;background:rgba(255,68,68,0.04);}

/* ETHICS ‚Äî special styling */
.ethics-card{border:1px solid rgba(255,170,0,0.3);border-radius:4px;padding:16px;margin:10px 0;cursor:pointer;transition:all 0.25s;font-size:0.85rem;background:rgba(255,170,0,0.02);}
.ethics-card:hover{border-color:#ffaa00;background:rgba(255,170,0,0.05);}
.ethics-card h4{margin:0 0 6px;color:#ffaa00;}
.ethics-card p{margin:0;opacity:0.7;font-size:0.82rem;line-height:1.6;}
.ethics-card.chosen{border-color:#ffaa00;background:rgba(255,170,0,0.06);}

/* PHASE LABELS */
.phase-banner{font-size:0.72rem;letter-spacing:3px;opacity:0.5;margin-bottom:10px;text-transform:uppercase;}

/* DARWIN KEY ASSEMBLY */
.key-fragment{display:inline-block;padding:4px 10px;border:1px solid #00ffcc44;border-radius:3px;font-size:0.82rem;margin:3px;color:#555;transition:all 0.6s ease;}
.key-fragment.unlocked{color:#00ffcc;border-color:#00ffcc;box-shadow:0 0 8px rgba(0,255,204,0.4);}

/* SIGNAL GRID */
.signal-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin:12px 0;}
.sig-node{border:1px solid rgba(255,68,68,0.3);border-radius:4px;padding:10px;text-align:center;font-size:0.78rem;color:#ff4444;background:rgba(255,68,68,0.04);}
.sig-node.killed{border-color:#00ffcc33;color:#333;background:transparent;text-decoration:line-through;animation:none;}
.sig-node.killing{animation:ashflicker 0.4s infinite;}

/* FINAL SCREEN */
#finale-wrap{text-align:center;padding:20px 0;}
.finale-title{font-size:2rem;color:#00ffcc;text-shadow:0 0 20px rgba(0,255,204,0.8);margin-bottom:16px;animation:glowpulse 2s infinite;}
@keyframes glowpulse{0%,100%{text-shadow:0 0 20px rgba(0,255,204,0.8);}50%{text-shadow:0 0 40px rgba(0,255,204,1),0 0 60px rgba(0,255,204,0.4);}}
.season-badge{border:1px solid #00ffcc;border-radius:6px;padding:14px 24px;display:inline-block;margin:16px auto;font-size:0.85rem;opacity:0.8;box-shadow:0 0 20px rgba(0,255,204,0.3);}
</style>
</head>
<body>

<div id="cookie"><div id="cookie-avatar">üêæ</div><div id="cookie-text">COOKIE v1.3 ‚Äî This is it. Everything you've learned. Right now.</div></div>

<h1>DEFENDERS GUILD</h1>
<p style="opacity:0.6;margin:0 0 4px;">SEASON 1 ‚Äî FINALE</p>
<h2>LAB 10 // OPERATION: KILL SPECTER</h2>
<div id="pb-outer"><div id="pb"></div></div>

<div class="panel"><div class="boot typing-cursor" id="boot-text"></div></div>

<!-- BOSS BAR + VAULT INTEGRITY ‚Äî always visible once lab starts -->
<div class="panel" id="status-panel" style="display:none;">
  <div style="display:flex;gap:24px;flex-wrap:wrap;">
    <div style="flex:2;min-width:220px;">
      <div id="asher-wrap">
        <div id="asher-label-row">
          <span id="asher-name">‚ö° ASHER ‚Äî FILL SPECTER</span>
          <span id="asher-signal-pct">SIGNAL: 100%</span>
        </div>
        <div id="asher-outer"><div id="asher-bar"></div></div>
        <div id="asher-status">SIGNAL STRONG ‚Äî VAULT UNDER ATTACK</div>
      </div>
    </div>
    <div style="flex:1;min-width:160px;">
      <div style="display:flex;justify-content:space-between;font-size:0.8rem;opacity:0.6;margin-bottom:4px;"><span>VAULT INTEGRITY</span><span id="vi-pct">85%</span></div>
      <div id="vi-outer"><div id="vi-bar"></div></div>
      <div id="vi-status" style="font-size:0.75rem;color:#ffaa00;margin-top:4px;">‚ö† UNDER ATTACK</div>
    </div>
  </div>
  <!-- Darwin Key Assembly -->
  <div style="margin-top:14px;border-top:1px solid rgba(0,255,204,0.1);padding-top:12px;">
    <p style="font-size:0.75rem;opacity:0.5;margin:0 0 6px;letter-spacing:2px;">DARWIN KEY ‚Äî ASSEMBLY STATUS</p>
    <div>
      <span class="key-fragment" id="kf1">FRAGMENT-1</span>
      <span class="key-fragment" id="kf2">FRAGMENT-2</span>
      <span class="key-fragment" id="kf3">FRAGMENT-3</span>
      <span style="font-size:0.8rem;opacity:0.4;margin:0 6px;">‚Üí</span>
      <span class="key-fragment" id="kf-full" style="padding:4px 14px;">DARWIN KEY [LOCKED]</span>
    </div>
  </div>
</div>

<!-- PHASE 1 ‚Äî DECEPTION LAYER -->
<div class="panel" id="panel-p1">
  <div class="phase-banner">Phase 1 of 5 ‚Äî Deception Layer</div>
  <h3>PHASE 1 ‚Äî CUT THROUGH THE NOISE</h3>

  <div class="story-beat">
    vault-admin-07 has been confronted and suspended pending investigation. But before the Guild could fully revoke access, they triggered a dead-man's switch ‚Äî a pre-staged payload that unleashed Asher's endgame: <em>Fill Specter</em>. This isn't a Byte Bug campaign. Specter is Asher himself, operating directly, running a multi-layer attack designed to overwhelm your detection systems with thousands of simultaneous false alerts while his real payload moves quietly underneath. The Guild's alert console is already showing 2,400 new events in the last 90 seconds. Most of them are manufactured noise. You need to find the real signal before the flood buries it.
  </div>

  <p style="opacity:0.7;font-size:0.85rem;">Specter's opening move is a deception layer ‚Äî flooding every monitoring system with synthetic alerts designed to look real. If you react to all of them, you'll exhaust your containment resources on ghosts while the actual intrusion proceeds unchecked. You need to identify the real signal pattern underneath the noise.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> Real attack signals have a source, a destination, and a consistent pattern. Synthetic alerts are generated in bulk ‚Äî they lack the process-level correlation that genuine events carry. Cross-reference the alert feed against process creation logs. If an alert has no matching process event on the source host, it's fake.
  </p>
  <div id="p1-opts" style="margin-top:14px;"></div>
  <p id="p1-status" style="margin-top:10px;font-size:0.85rem;"></p>
</div>

<!-- PHASE 2 ‚Äî PSYCHOLOGICAL EXPLOIT -->
<div class="panel hidden" id="panel-p2">
  <div class="phase-banner">Phase 2 of 5 ‚Äî Psychological Exploit</div>
  <h3>PHASE 2 ‚Äî DON'T FLINCH</h3>

  <div class="story-beat">
    Specter's second move is personal. He's broadcast your own activity logs ‚Äî your keystrokes, your decisions across Labs 1‚Äì9 ‚Äî back into the Guild's internal network. He wants you to panic. He wants you to overreact, shut everything down, and hand him the window he needs. A message arrives in the terminal: <em>"I've been watching you learn. Everything you know, I taught you ‚Äî through my attacks. Shut it all down and I'll leave the Vault intact."</em> This is a bluff. Asher can't leave the Vault intact ‚Äî the Darwin Key fragments are still here. He needs them. He needs you to go dark so he can take them unopposed.
  </div>

  <p style="opacity:0.7;font-size:0.85rem;">A compromised system has been used to broadcast your session data. Specter wants you to react emotionally ‚Äî shut the whole Vault down, destroy evidence, give him the operational pause he needs. The forensic chain from Labs 5‚Äì9 lives on this system. If you wipe it, the investigation into vault-admin-07 collapses. The right response is surgical: isolate the exposed system, preserve every log, and keep the rest of the Vault running.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> Asher is trying to trigger a panic response. In incident response, the most dangerous thing you can do is make irreversible decisions under pressure. Isolate, don't destroy. Preserve, don't erase. Keep the rest operational ‚Äî shutting down the Vault gives Specter exactly the darkness he needs to move.
  </p>
  <div id="p2-opts" style="margin-top:14px;"></div>
  <p id="p2-status" style="margin-top:10px;font-size:0.85rem;"></p>
</div>

<!-- PHASE 3 ‚Äî KERNEL ROOTKIT -->
<div class="panel hidden" id="panel-p3">
  <div class="phase-banner">Phase 3 of 5 ‚Äî Kernel-Level Persistence</div>
  <h3>PHASE 3 ‚Äî ROOT IT OUT</h3>

  <div class="story-beat">
    The forensic store is safe. But the system that broadcast your logs has a rootkit embedded below the operating system ‚Äî in the kernel itself. This is Specter's deepest foothold. A kernel-level implant can survive reboots, hide from standard process scans, and intercept security tool calls before they complete. You can't clean it with standard removal tools because the implant can see those tools coming and lie to them. Darwin's research notes ‚Äî recovered from the archive in Lab 5 ‚Äî describe exactly this attack vector. He'd seen Asher use it before. And he left instructions.
  </div>

  <p style="opacity:0.7;font-size:0.85rem;">Standard malware removal won't work here ‚Äî the rootkit intercepts removal attempts at the kernel level and hides itself. The only reliable method is to capture a full memory image first (for evidence and to extract the rootkit signature), then reimage the node entirely from a clean baseline. Attempting live removal gives the rootkit time to migrate or destroy evidence.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> Memory capture before reimage serves two purposes: it freezes the rootkit's current state as evidence, and it lets the Guild extract the full implant signature to build a detection rule that catches it if Asher deploys it again. Don't skip the capture step ‚Äî it's the difference between closing the case and leaving the next door open.
  </p>
  <div id="p3-opts" style="margin-top:14px;"></div>
  <p id="p3-status" style="margin-top:10px;font-size:0.85rem;"></p>
</div>

<!-- PHASE 4 ‚Äî DARWIN KEY -->
<div class="panel hidden" id="panel-p4">
  <div class="phase-banner">Phase 4 of 5 ‚Äî The Darwin Key</div>
  <h3>PHASE 4 ‚Äî ASSEMBLE THE KEY</h3>

  <div class="story-beat">
    The node is clean. And the memory capture found something inside the rootkit's data partition that Asher had already retrieved ‚Äî Darwin Key Fragment 3. He had all three fragments. But when the rootkit was terminated mid-operation, the assembly process failed. The fragments are still here, scattered across the forensic store and the recovered relay config from Lab 7. Darwin designed the key as a multi-part unlock for something he built inside the Vault's core architecture ‚Äî a failsafe. A way to permanently lock Asher out of every Guild system, past and future, by revoking the cryptographic root that his entire operation relies on. You now have all three pieces. The question is whether you can assemble them correctly before Asher reroutes through a new relay and tries again.
  </div>

  <p style="opacity:0.7;font-size:0.85rem;">Fragment 1 was recovered from the Darwin cache in Lab 4. Fragment 2 was found embedded in Asher's own malware in Lab 5. Fragment 3 was just extracted from the rootkit's data partition. Assembling the key requires applying them in the correct sequence ‚Äî Darwin designed the order as a puzzle only someone who had followed his trail from the beginning would know.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> Think about where each fragment appeared. Fragment 1 was hidden in the Vault's node cache ‚Äî inside Guild infrastructure. Fragment 2 was embedded in Asher's own malware ‚Äî Darwin hid it where Asher would carry it without knowing. Fragment 3 was inside the rootkit Asher deployed last. The order reflects Darwin's logic: Vault first, then the attacker's own tools, then the deepest layer of the attack. Assembly sequence: infrastructure ‚Üí payload ‚Üí rootkit.
  </p>
  <div id="p4-opts" style="margin-top:14px;"></div>
  <p id="p4-status" style="margin-top:10px;font-size:0.85rem;"></p>
</div>

<!-- PHASE 5 ‚Äî ETHICAL DECISION -->
<div class="panel hidden" id="panel-p5">
  <div class="phase-banner">Phase 5 of 5 ‚Äî The Final Decision</div>
  <h3>PHASE 5 ‚Äî WHAT KIND OF DEFENDER ARE YOU</h3>

  <div class="story-beat">
    The Darwin Key is assembled. One command will revoke Asher's cryptographic root across every system he's ever touched ‚Äî Vault nodes, relay servers, the mole's access credentials, all of it. His entire operation collapses. But during the rootkit analysis, the Guild's cryptography team found something else Darwin built into the key: a secondary function. Activating it doesn't just lock Asher out. It also deploys a persistent behavioral surveillance layer across all Guild accounts ‚Äî monitoring every keystroke, every access, every communication, indefinitely. No warrants. No review. No sunset clause. Darwin built it as a last resort because he didn't trust the Guild's internal processes to catch the next insider threat in time. <em>He may have been right.</em> vault-admin-07 almost succeeded. But the same tool that catches the next mole also watches every Defender who ever works for the Guild ‚Äî including you.
  </div>

  <p style="opacity:0.7;font-size:0.85rem;margin-bottom:14px;">You can activate the Darwin Key in one of two ways. Both neutralize Asher. Only one has a cost that extends beyond today.</p>

  <div id="p5-opts"></div>
  <p id="p5-status" style="margin-top:12px;font-size:0.85rem;"></p>
</div>

<div class="log" id="log">
  <p class="info">// LAB 10 INITIALIZED ‚Äî OPERATION KILL SPECTER</p>
  <p class="info">// WARNING: Fill Specter signature detected across all Vault segments</p>
  <p class="info">// All prior lab data active ‚Äî this is the endgame</p>
</div>

<!-- COMPLETION -->
<div class="panel hidden" id="complete-panel" style="box-shadow:0 0 30px rgba(0,255,204,0.5);">
  <div id="finale-wrap">
    <div class="finale-title">SEASON 1 COMPLETE</div>
    <p style="opacity:0.8;margin-bottom:6px;">Fill Specter has been neutralized. The Darwin Key has been activated. Asher's signal has dropped to zero.</p>
    <div class="season-badge">
      DEFENDER CERTIFIED ‚Äî SEASON 1<br>
      <span style="opacity:0.6;font-size:0.8rem;">Labs 1‚Äì10 Complete ¬∑ All skills earned</span>
    </div>
    <div id="ethics-outcome" style="margin:16px 0;padding:14px;border:1px solid rgba(255,170,0,0.3);border-radius:4px;font-size:0.85rem;color:#ffaa00;background:rgba(255,170,0,0.03);text-align:left;"></div>
    <p style="color:#888;font-size:0.85rem;margin-top:14px;text-align:left;">
      Somewhere in the Guild's recovered server logs, a final message from Darwin ‚Äî timestamped three years ago, written before any of this began:<br><br>
      <em style="color:#00ffcc99;">"If you're reading this, you followed the whole trail. That means you're exactly who I was building this for. The Vault will need more than a key to stay safe. It needs Defenders who understand that protecting a system and respecting the people inside it aren't two different jobs. They're the same job. Don't forget that."</em>
    </p>
    <p style="color:#555;font-size:0.8rem;margin-top:20px;">Your decision in Phase 5 has been saved. It will shape the world of Season 2.</p>
  </div>
  <br>
  <div style="display:flex;gap:14px;flex-wrap:wrap;margin-top:8px;">
    <a href="defenders-dashboard.html"><button style="box-shadow:0 0 12px rgba(0,255,204,0.4);">‚åÇ RETURN TO DASHBOARD</button></a>
  </div>
</div>

<script>
const narrative=`> DEFENDERS GUILD ‚Äî BOOTLOADER v1.0\n> CRITICAL ALERT: Fill Specter ‚Äî ACTIVE\n> Attack surface: ALL VAULT SEGMENTS\n> Synthetic alert flood: 2,400 events in 90 seconds\n> Darwin Key fragments: LOCATED ‚Äî assembly required\n> vault-admin-07: SUSPENDED ‚Äî dead-man payload TRIGGERED\n> This is not a drill.\n> Defender ‚Äî everything you know. Right now.`;
let ci=0;const be=document.getElementById('boot-text');
function typeIt(){if(ci<narrative.length){be.textContent+=narrative[ci++];setTimeout(typeIt,22);}else{be.classList.remove('typing-cursor');startLab();}}
typeIt();

// ASHER SIGNAL
let asherSignal=100;
function setAsherSignal(v){
  asherSignal=Math.max(0,Math.min(100,v));
  const pct=asherSignal;
  document.getElementById('asher-signal-pct').textContent='SIGNAL: '+pct+'%';
  document.getElementById('asher-bar').style.width=pct+'%';
  const bar=document.getElementById('asher-bar'),st=document.getElementById('asher-status');
  bar.classList.remove('flicker','critical');
  if(pct<=0){
    bar.style.width='0%';
    st.textContent='‚ñì SIGNAL DEAD ‚Äî ASHER DISCONNECTED';
    st.style.color='#00ffcc';
    document.getElementById('asher-name').style.color='#555';
    document.getElementById('asher-signal-pct').style.color='#555';
  } else if(pct<=25){
    bar.classList.add('critical');
    st.textContent='‚ö° CRITICAL ‚Äî SPECTER COLLAPSING';
    st.style.color='#ff4444';
  } else if(pct<=50){
    bar.classList.add('flicker');
    st.textContent='‚ö† WEAKENING ‚Äî ASHER LOSING CONTROL';
    st.style.color='#ffaa00';
  } else {
    st.textContent='SIGNAL STRONG ‚Äî VAULT UNDER ATTACK';
    st.style.color='#ff4444';
  }
}

// VAULT INTEGRITY
let vi=85;
function setVI(v){
  vi=Math.max(0,Math.min(100,v));
  document.getElementById('vi-pct').textContent=vi+'%';
  document.getElementById('vi-bar').style.width=vi+'%';
  const bar=document.getElementById('vi-bar'),st=document.getElementById('vi-status');
  bar.classList.remove('low','mid');
  if(vi>=75){bar.classList.remove('low','mid');st.style.color='#00ffcc';st.textContent='‚úì HOLDING';}
  else if(vi>=50){bar.classList.add('mid');st.style.color='#ffaa00';st.textContent='‚ö† UNDER PRESSURE';}
  else{bar.classList.add('low');st.style.color='#ff4444';st.textContent='‚ö† CRITICAL';}
}

const phases={p1:false,p2:false,p3:false,p4:false,p5:false};
function updatePB(){const d=Object.values(phases).filter(Boolean).length;document.getElementById('pb').style.width=(d/5*100)+'%';}
function lg(m,c=''){const l=document.getElementById('log');const p=document.createElement('p');if(c)p.className=c;p.textContent=m;l.appendChild(p);l.scrollTop=l.scrollHeight;}
function cookie(m){document.getElementById('cookie-text').textContent=m;}
function unlockFragment(n){
  const el=document.getElementById('kf'+n);
  if(el){el.classList.add('unlocked');el.textContent='FRAGMENT-'+n+' ‚úì';}
}

function startLab(){
  document.getElementById('status-panel').style.display='block';
  setAsherSignal(100);setVI(85);
  buildP1();buildP2();buildP3();buildP4();buildP5();
  cookie('Specter is live across every segment. Start with the noise ‚Äî find the real signal underneath it.');
  lg('> Fill Specter: ACTIVE across all Vault segments','danger');
  lg('> Synthetic alert flood initiated ‚Äî 2,400 events','danger');
  lg('> Vault integrity holding at 85% ‚Äî for now','warn');
}

// PHASE 1
function buildP1(){
  const opts=[
    {title:'CROSS-REFERENCE ALERTS AGAINST PROCESS LOGS',detail:'Filter the alert flood through process creation logs. Any alert with no matching process event on the source host is synthetic. This narrows 2,400 events down to the real ones.',correct:true,feedback:'Correct. Cross-referencing kills Specter\'s noise strategy. You reduced 2,400 alerts to 11 confirmed real events in under 90 seconds. Asher\'s deception layer has failed.'},
    {title:'TRIGGER MASS CONTAINMENT ‚Äî LOCK EVERYTHING',detail:'Isolate all nodes immediately to stop every potential threat at once. Comprehensive, fast, total.',correct:false,feedback:'This is what Specter wants. Mass containment takes the Vault offline and hands Asher unmonitored access to the Darwin Key fragments. You can\'t defend what you can\'t see.'},
    {title:'SHUT DOWN THE ALERT CONSOLE ‚Äî REDUCE THE NOISE',detail:'Disable the alert feed to clear the overload. Work from known baselines only.',correct:false,feedback:'Turning off your sensors is always the wrong call. You\'d be flying blind while Specter moves freely. The noise is a weapon ‚Äî don\'t let it take your eyes offline.'},
  ];
  buildOpts('p1',opts);
}

// PHASE 2
function buildP2(){
  const opts=[
    {title:'ISOLATE EXPOSED SYSTEM + PRESERVE FORENSIC CHAIN',detail:'Immediately cut the broadcasting node from the network. Freeze all logs, session data, and the evidence trail from Labs 5‚Äì9 in place. Keep every other system running. Don\'t give Asher the darkness he needs.',correct:true,feedback:'Exactly right. The broadcast is a distraction. Isolating the node stops the leak without disrupting the Vault\'s visibility. The forensic chain from vault-admin-07\'s investigation is intact. Asher\'s bluff failed.'},
    {title:'SHUT DOWN THE ENTIRE VAULT ‚Äî PROTECT ALL SYSTEMS',detail:'Take everything offline immediately. Total shutdown eliminates the exposure surface completely.',correct:false,feedback:'Total shutdown is exactly what Specter\'s message was designed to trigger. The Vault goes dark, monitoring stops, and Asher operates freely in the blackout. Never make irreversible decisions under psychological pressure.'},
    {title:'RESPOND TO ASHER\'S MESSAGE ‚Äî NEGOTIATE',detail:'Engage with the offer. Gather intelligence on his intentions before deciding how to respond.',correct:false,feedback:'Asher has no intention of leaving the Vault intact ‚Äî the Darwin Key fragments are here. The offer is a stalling tactic. Every second spent negotiating is a second his payload moves forward.'},
  ];
  buildOpts('p2',opts);
}

// PHASE 3
function buildP3(){
  const opts=[
    {title:'MEMORY CAPTURE + FULL NODE REIMAGE',detail:'Capture a complete memory image of the infected node first ‚Äî freezes the rootkit, extracts its signature as evidence, and logs everything in its data partition. Then reimage from a verified clean baseline. Surgical and complete.',correct:true,feedback:'Perfect execution. The memory capture extracted the rootkit signature for future detection rules ‚Äî and found Darwin Key Fragment 3 in the rootkit\'s data partition. The node is clean. Asher has lost his deepest foothold.'},
    {title:'ATTEMPT LIVE ROOTKIT REMOVAL',detail:'Use a kernel-level removal tool to excise the rootkit while the system is running.',correct:false,feedback:'The rootkit intercepts removal tool calls at the kernel level. It can see the removal attempt coming and hide or migrate before it completes. Live removal against a kernel implant almost always fails and alerts the attacker that you found it.'},
    {title:'QUARANTINE THE NODE AND LEAVE IT',detail:'Isolate the infected node and leave the rootkit dormant. It can\'t spread if the node is offline.',correct:false,feedback:'Quarantine without reimage leaves Asher\'s foothold intact. A dormant rootkit can be reactivated if network access is ever restored ‚Äî and it still holds whatever data Asher collected. You need a clean slate, not a locked room.'},
  ];
  buildOpts('p3',opts);
}

// PHASE 4 ‚Äî KEY ASSEMBLY SEQUENCE
function buildP4(){
  const wrap=document.getElementById('p4-opts');
  wrap.innerHTML=`<p style="font-size:0.82rem;opacity:0.7;margin-bottom:12px;">Select the correct assembly sequence for the three Darwin Key fragments. Click them in order ‚Äî Fragment that goes first, second, third:</p>
  <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;" id="fragment-btns">
    <button id="fb1" onclick="selectFragment(1,this)">FRAGMENT-1<br><span style="font-size:0.72rem;opacity:0.5;">Found: Vault node cache (Lab 4)</span></button>
    <button id="fb2" onclick="selectFragment(2,this)">FRAGMENT-2<br><span style="font-size:0.72rem;opacity:0.5;">Found: Asher's malware (Lab 5)</span></button>
    <button id="fb3" onclick="selectFragment(3,this)">FRAGMENT-3<br><span style="font-size:0.72rem;opacity:0.5;">Found: Rootkit data partition (Lab 10)</span></button>
  </div>
  <div id="assembly-slots" style="display:flex;gap:10px;margin-bottom:12px;flex-wrap:wrap;">
    <div style="border:1px dashed #00ffcc33;border-radius:4px;padding:10px 20px;min-width:130px;text-align:center;font-size:0.8rem;color:#333;" id="slot1">SLOT 1</div>
    <div style="border:1px dashed #00ffcc33;border-radius:4px;padding:10px 20px;min-width:130px;text-align:center;font-size:0.8rem;color:#333;" id="slot2">SLOT 2</div>
    <div style="border:1px dashed #00ffcc33;border-radius:4px;padding:10px 20px;min-width:130px;text-align:center;font-size:0.8rem;color:#333;" id="slot3">SLOT 3</div>
  </div>
  <button id="assemble-btn" onclick="assembleKey()" disabled>‚ñ∂ ASSEMBLE DARWIN KEY</button>`;
}
let fragSeq=[],fragDone=false;
const correctSeq=[1,2,3];
function selectFragment(n,btn){
  if(fragDone||fragSeq.includes(n))return;
  fragSeq.push(n);
  const slot=document.getElementById('slot'+fragSeq.length);
  if(slot){slot.textContent='FRAGMENT-'+n;slot.style.borderColor='#ffaa00';slot.style.color='#ffaa00';}
  btn.disabled=true;btn.style.borderColor='#555';btn.style.color='#555';
  if(fragSeq.length===3)document.getElementById('assemble-btn').disabled=false;
}
function assembleKey(){
  document.getElementById('assemble-btn').disabled=true;
  const correct=fragSeq.join('')===correctSeq.join('');
  const st=document.getElementById('p4-status');
  if(correct){
    fragDone=true;
    lg('> Darwin Key assembly sequence confirmed: Fragment-1 ‚Üí Fragment-2 ‚Üí Fragment-3','success');
    [1,2,3].forEach((n,i)=>setTimeout(()=>{
      unlockFragment(n);
      document.getElementById('slot'+n).style.borderColor='#00ffcc';
      document.getElementById('slot'+n).style.color='#00ffcc';
    },i*500));
    setTimeout(()=>{
      document.getElementById('kf-full').classList.add('unlocked');
      document.getElementById('kf-full').textContent='DARWIN KEY [READY]';
      st.innerHTML='<span style="color:#00ffcc;">‚úì Darwin Key assembled. Cryptographic root revocation ready. Phase 4 complete.</span>';
      phases.p4=true;updatePB();
      setAsherSignal(asherSignal-30);
      setVI(vi+8);
      document.getElementById('panel-p5').classList.remove('hidden');
      lg('> Darwin Key assembled. Asher\'s signal weakening.','success');
      cookie('The key is ready. One decision left. Make it count.');
    },1800);
  } else {
    st.innerHTML='<span style="color:#ffaa00;">‚ö† Incorrect sequence. Think about where Darwin hid each fragment ‚Äî the order reflects how deep each one was buried. Vault infrastructure first, then the attacker\'s own tools, then the deepest layer.</span>';
    fragSeq=[];
    [1,2,3].forEach(n=>{
      const b=document.getElementById('fb'+n);if(b){b.disabled=false;b.style.borderColor='#00ffcc';b.style.color='#00ffcc';}
      const s=document.getElementById('slot'+n);if(s){s.textContent='SLOT '+n;s.style.borderColor='#00ffcc33';s.style.color='#333';}
    });
    document.getElementById('assemble-btn').disabled=true;
    setVI(vi-5);
    lg('> Key assembly failed ‚Äî incorrect sequence','warn');
    cookie('Wrong order. Darwin hid them in layers ‚Äî infrastructure, then Asher\'s payload, then the rootkit.');
  }
}

// PHASE 5 ‚Äî ETHICS
function buildP5(){
  const wrap=document.getElementById('p5-opts');
  const opts=[
    {
      id:'e1',
      title:'ACTIVATE KEY ‚Äî LOCK OUT ASHER ONLY',
      detail:'Use the Darwin Key\'s primary function only. Revoke Asher\'s cryptographic root across all systems. His entire operation collapses permanently. The Guild\'s internal surveillance layer is not deployed. Defenders and Guild staff retain full privacy. The Vault is protected by detection and response ‚Äî not by watching everyone inside it.',
      tag:'PRIVACY PRESERVED',
      outcome_title:'You chose integrity.',
      outcome:'The key revoked Asher\'s access across every system he\'d ever touched. His operation collapsed in 4.2 seconds. The Guild\'s staff retained their privacy. Darwin\'s failsafe worked exactly as the first function intended. The risk is that the next insider threat will need to be caught the same way vault-admin-07 was caught ‚Äî through evidence, investigation, and the systems you built. That will be harder. But it will be honest.',
      value:'lockout_only'
    },
    {
      id:'e2',
      title:'ACTIVATE KEY ‚Äî FULL FUNCTION',
      detail:'Use both functions of the Darwin Key. Asher is locked out permanently AND the behavioral surveillance layer deploys across all Guild accounts. Every action by every Defender is logged and monitored indefinitely. The next insider threat will be caught before they act. The cost: everyone who ever works for the Guild will be watched ‚Äî including you ‚Äî without their knowledge or consent.',
      tag:'SURVEILLANCE DEPLOYED',
      outcome_title:'You chose certainty.',
      outcome:'The key revoked Asher\'s access and deployed Darwin\'s surveillance layer across every Guild account. The system will catch the next insider threat faster. vault-admin-07\'s replacement will never get as far. But every Defender who joins the Guild from this point forward will be monitored without knowing it. Darwin built this option because he was afraid. Whether that fear was justified ‚Äî and whether the cost was worth paying ‚Äî is a question that will follow the Guild into Season 2.',
      value:'full_surveillance'
    },
  ];
  opts.forEach(o=>{
    const d=document.createElement('div');d.className='ethics-card';
    d.innerHTML=`<h4>${o.title} <span style="font-size:0.72rem;border:1px solid #ffaa0066;padding:1px 6px;border-radius:2px;margin-left:6px;">${o.tag}</span></h4><p>${o.detail}</p>`;
    d.onclick=()=>chooseEthics(o,d);
    wrap.appendChild(d);
  });
}
let ethicsDone=false;
function chooseEthics(opt,el){
  if(ethicsDone)return;
  ethicsDone=true;
  document.querySelectorAll('#p5-opts .ethics-card').forEach(c=>{c.onclick=null;c.style.cursor='default';});
  el.classList.add('chosen');
  localStorage.setItem('s1_ethics_choice',opt.value);
  localStorage.setItem('s1lab10','complete');
  lg(`> Darwin Key activated ‚Äî ${opt.title}`,'success');
  document.getElementById('p5-status').innerHTML=`<span style="color:#ffaa00;">‚úì Decision recorded. Key deploying...</span>`;
  cookie('The key is in motion. Watch Asher\'s signal.');

  // Dramatic signal death sequence
  let drops=[70,45,20,8,0];
  drops.forEach((v,i)=>setTimeout(()=>{
    setAsherSignal(v);
    if(v===45)lg('> Asher\'s relay nodes: REVOKED','success');
    if(v===20)lg('> Byte Bug infrastructure: COLLAPSED','success');
    if(v===8)lg('> Fill Specter signature: FADING','success');
    if(v===0){
      lg('>>> FILL SPECTER: NEUTRALIZED <<<','success');
      lg('>>> ASHER SIGNAL: ZERO <<<','success');
      setVI(98);
      phases.p5=true;updatePB();
      setTimeout(()=>showComplete(opt),1200);
    }
  },(i+1)*1000));
}

// GENERIC OPTION BUILDER
function buildOpts(pid,opts){
  const wrap=document.getElementById(pid+'-opts');
  opts.forEach((o,i)=>{
    const d=document.createElement('div');d.className='opt-card';
    d.innerHTML=`<h4>${o.title}</h4><p>${o.detail}</p>`;
    d.onclick=()=>chooseOpt(pid,i,d,o);
    wrap.appendChild(d);
  });
}
const phaseDone={};
function chooseOpt(pid,i,el,opt){
  if(phaseDone[pid])return;
  document.querySelectorAll('#'+pid+'-opts .opt-card').forEach(c=>{c.onclick=null;c.style.cursor='default';});
  const st=document.getElementById(pid+'-status');
  const phaseNum=parseInt(pid.replace('p',''));
  if(opt.correct){
    phaseDone[pid]=true;
    el.classList.add('chosen-right');
    st.innerHTML=`<span style="color:#00ffcc;">‚úì ${opt.feedback}</span>`;
    phases['p'+phaseNum]=true;updatePB();
    const signalDrop=[25,20,20][phaseNum-1]||20;
    const viGain=[0,5,8][phaseNum-1]||5;
    setAsherSignal(asherSignal-signalDrop);
    setVI(vi+viGain);
    lg(`> Phase ${phaseNum} complete ‚Äî ${opt.title}`,'success');
    if(phaseNum===1){
      unlockFragment(1);
      document.getElementById('panel-p2').classList.remove('hidden');
      cookie('Noise cleared. Specter is adapting ‚Äî get ready for his next move.');
    } else if(phaseNum===2){
      unlockFragment(2);
      document.getElementById('panel-p3').classList.remove('hidden');
      cookie('Forensic chain intact. He\'s going deeper now ‚Äî kernel level.');
    } else if(phaseNum===3){
      document.getElementById('panel-p4').classList.remove('hidden');
      cookie('Rootkit gone. Fragment 3 recovered. Assemble the key.');
    }
  } else {
    el.classList.add('chosen-wrong');
    st.innerHTML=`<span style="color:#ffaa00;">‚ö† ${opt.feedback}</span>`;
    setVI(vi-10);
    lg(`> Wrong call ‚Äî Specter advances`,'warn');
    cookie('That gave Specter ground. Regroup ‚Äî try again.');
    setTimeout(()=>{
      el.classList.remove('chosen-wrong');
      document.querySelectorAll('#'+pid+'-opts .opt-card').forEach((c,ci)=>{
        const opts_ref=document.getElementById(pid+'-opts').querySelectorAll('.opt-card');
        c.onclick=()=>chooseOpt(pid,ci,c,{title:c.querySelector('h4').textContent,detail:c.querySelector('p').textContent,correct:opt.correct!==true&&ci===Array.from(opts_ref).indexOf(document.getElementById(pid+'-opts').querySelector('.opt-card[data-correct]'))});
      });
      // Rebuild clean
      const panel=document.getElementById('panel-p'+phaseNum);
      document.getElementById(pid+'-opts').innerHTML='';
      const builders=[null,buildP1,buildP2,buildP3];
      if(builders[phaseNum])builders[phaseNum]();
    },1400);
  }
}

function showComplete(opt){
  document.getElementById('complete-panel').classList.remove('hidden');
  document.getElementById('complete-panel').scrollIntoView({behavior:'smooth'});
  document.getElementById('ethics-outcome').innerHTML=`<strong>${opt.outcome_title}</strong><br><br>${opt.outcome}`;
  lg('>>> SEASON 1 COMPLETE. OPERATION KILL SPECTER: SUCCESS. <<<','success');
  cookie('It\'s over. For now. Season 2 starts where this ends.');
}
</script>
</body>
</html>
