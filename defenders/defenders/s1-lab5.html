<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DEFENDERS ‚Äî Lab 5: Digital Forensics</title>
<style>
*,*::before,*::after{box-sizing:border-box;}
body{background-color:#000;color:#00ffcc;font-family:'Courier New',Courier,monospace;font-size:16px;line-height:1.4;margin:0;padding:20px;overflow-x:hidden;}
h1,h2,h3,h4{font-family:'Courier New',Courier,monospace;color:#00ffcc;margin:0 0 12px 0;}
h1{font-size:2rem;}h2{font-size:1.6rem;}h3{font-size:1.3rem;}
a{color:#00ffcc;text-decoration:none;}a:hover{text-decoration:underline;}
.hidden{display:none;}.center{text-align:center;}
.panel{border:1px solid #00ffcc;padding:18px;margin:20px 0;background-color:rgba(0,0,0,0.85);border-radius:6px;box-shadow:0 0 12px rgba(0,255,204,0.4);}
button{background-color:#000;border:1px solid #00ffcc;color:#00ffcc;padding:10px 16px;cursor:pointer;font-family:monospace;font-size:0.95rem;border-radius:4px;transition:all 0.2s ease;display:inline-block;}
button:hover{background-color:#002;box-shadow:0 0 8px #00ffcc;}
button:disabled{opacity:0.4;cursor:not-allowed;}
#cookie{position:fixed;top:20px;right:20px;width:240px;border:1px solid #00ffcc;background:#000;padding:12px;box-shadow:0 0 18px rgba(0,255,204,.5);font-size:0.9rem;z-index:9999;border-radius:8px;}
#cookie-avatar{font-size:1.6rem;margin-bottom:6px;}
#cookie-text{opacity:0.95;line-height:1.4;}
#cookie::before{content:"";position:absolute;inset:0;background:linear-gradient(rgba(0,255,204,0.05),transparent);pointer-events:none;}
.boot{font-size:1.1rem;margin-bottom:20px;white-space:pre-wrap;word-break:break-word;min-height:60px;}
.typing-cursor::after{content:"_";animation:blink 1s step-end infinite;}
@keyframes blink{from,to{opacity:0;}50%{opacity:1;}}
.log{background-color:#001;border:1px solid #00ffcc;padding:12px;margin-top:20px;height:220px;overflow-y:auto;font-size:0.85rem;border-radius:4px;box-shadow:0 0 10px rgba(0,255,204,0.3);}
.log p{margin:3px 0;}.warn{color:#ffaa00;}.danger{color:#ff4444;}.success{color:#00ffcc;}.info{color:#888;}
#pb-outer{background:rgba(0,255,204,0.1);border:1px solid #00ffcc44;border-radius:4px;height:8px;margin:10px 0 20px;overflow:hidden;}
#pb{height:100%;background:#00ffcc;width:0%;transition:width 0.5s ease;box-shadow:0 0 8px #00ffcc;}
/* evidence integrity bar */
#ei-outer{background:rgba(0,255,204,0.1);border:1px solid #00ffcc44;border-radius:4px;height:12px;margin:6px 0 4px;overflow:hidden;width:100%;}
#ei-bar{height:100%;background:#00ffcc;width:70%;transition:width 0.5s ease;box-shadow:0 0 6px #00ffcc;}
#ei-bar.low{background:#ff4444;box-shadow:0 0 6px #ff4444;}
/* artifact cards */
.artifact-card{border:1px solid rgba(0,255,204,0.25);border-radius:4px;padding:12px 14px;margin:8px 0;cursor:pointer;transition:all 0.2s ease;font-size:0.85rem;}
.artifact-card:hover{background:rgba(0,255,204,0.04);border-color:#00ffcc;}
.artifact-card.selected{border-color:#ffaa00;color:#ffaa00;background:rgba(255,170,0,0.04);}
.artifact-card.correct{border-color:#00ffcc;color:#00ffcc;background:rgba(0,255,204,0.06);}
.artifact-card.wrong{border-color:#ff4444;color:#ff4444;background:rgba(255,68,68,0.04);}
.artifact-card .meta{font-size:0.72rem;opacity:0.5;margin-top:4px;}
/* file hex viewer */
.hex-block{font-family:monospace;font-size:0.78rem;background:#001;border:1px solid rgba(0,255,204,0.2);padding:10px;border-radius:4px;line-height:1.8;margin:8px 0;overflow-x:auto;white-space:pre;}
.hex-block .hl{color:#ffaa00;}
/* answer buttons */
.answer-grid{display:flex;flex-direction:column;gap:8px;margin:12px 0;}
.answer-btn{text-align:left;padding:12px 14px;font-size:0.85rem;border-radius:4px;}
.answer-btn.wrong{border-color:#ff4444;color:#ff4444;}
</style>
</head>
<body>

<div id="cookie"><div id="cookie-avatar">üêæ</div><div id="cookie-text">COOKIE v1.3 ‚Äî Lab 5 online. The evidence doesn't lie. Let's read it.</div></div>

<h1>DEFENDERS GUILD</h1>
<p style="opacity:0.6;margin:0 0 4px;">SEASON 1 ‚Äî PHASE 3: FORENSICS</p>
<h2>LAB 05 // DIGITAL FORENSICS</h2>
<div id="pb-outer"><div id="pb"></div></div>

<div class="panel"><div class="boot typing-cursor" id="boot-text"></div></div>

<div class="panel">
  <h3>üìã MISSION BRIEF</h3>
  <p><strong>Skill Focus:</strong> Artifact recovery ¬∑ Log analysis ¬∑ Timeline reconstruction ¬∑ Root cause identification</p>
  <p><strong>Role Alignment:</strong> SOC Tier 2 / Digital Forensics Analyst</p>
  <p><strong>Story Context:</strong> The Vault is stable. The Byte Bugs are contained. But containment isn't enough ‚Äî if you don't understand exactly how Asher got in, he'll find another way. The Vault's forensic module recovered artifacts from the quarantine zone: log fragments, a partial disk image from the patient zero node, and a corrupted file that may contain something Darwin left behind. Your job is to examine the evidence, reconstruct the attack timeline, and identify the root cause so the Guild can close the door permanently.</p>
  <p><strong>Objectives:</strong> Examine recovered artifacts ¬∑ Reconstruct the attack timeline in sequence ¬∑ Analyze a disk image fragment ¬∑ Identify the true root cause of the breach</p>
</div>

<!-- EVIDENCE INTEGRITY -->
<div class="panel">
  <h3>EVIDENCE INTEGRITY</h3>
  <p style="opacity:0.7;font-size:0.85rem;">Every forensic mistake ‚Äî misreading an artifact, ordering events wrong ‚Äî degrades the evidence chain. Keep integrity above 60% to produce a valid investigation report. Below 60% and the findings become legally and operationally inadmissible.</p>
  <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
    <div style="flex:1;">
      <div style="display:flex;justify-content:space-between;font-size:0.8rem;opacity:0.6;margin-bottom:4px;"><span>EVIDENCE INTEGRITY</span><span id="ei-pct">70%</span></div>
      <div id="ei-outer"><div id="ei-bar"></div></div>
    </div>
    <span id="ei-label" style="color:#00ffcc;font-size:0.85rem;">‚úì ADMISSIBLE</span>
  </div>
</div>

<!-- PHASE 1 ‚Äî ARTIFACT EXAMINATION -->
<div class="panel">
  <h3>PHASE 1 ‚Äî ARTIFACT EXAMINATION</h3>
  <p style="opacity:0.7;font-size:0.85rem;">Four artifacts were recovered from the quarantine zone. Before you can reconstruct the timeline you need to understand what each one tells you. Read each artifact and tag it with what type of evidence it represents ‚Äî this determines how it fits into the chain of events.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> Forensic artifacts fall into a few categories ‚Äî <em>initial access</em> (how they got in), <em>execution</em> (what ran), <em>persistence</em> (how they stayed), and <em>exfiltration</em> (what they took). Match each artifact to the category that best describes what it proves.
  </p>
  <div id="artifact-list" style="margin-top:14px;"></div>
  <p id="artifact-status" style="margin-top:10px;font-size:0.85rem;color:#888;"></p>
</div>

<!-- PHASE 2 ‚Äî TIMELINE RECONSTRUCTION -->
<div class="panel">
  <h3>PHASE 2 ‚Äî TIMELINE RECONSTRUCTION</h3>
  <p style="opacity:0.7;font-size:0.85rem;">The five key events of the breach have been recovered from Darwin's log fragments ‚Äî but they're out of order. Click them in the sequence they actually happened. This is the attack timeline: getting it right matters because it determines what controls could have stopped the breach at each step.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> Think about what had to exist before each next step was possible. An attacker can't move laterally until they're already on the network. They can't steal credentials until malware is running. Work backwards from the end state ‚Äî a persistent backdoor ‚Äî and ask what each step required.
  </p>
  <div id="timeline-wrap" style="margin-top:14px;"></div>
  <br><button id="tl-verify-btn" onclick="verifyTimeline()">üîç VERIFY TIMELINE</button>
  <p id="tl-status" style="margin-top:10px;font-size:0.85rem;"></p>
</div>

<!-- PHASE 3 ‚Äî DISK IMAGE ANALYSIS -->
<div class="panel">
  <h3>PHASE 3 ‚Äî DISK IMAGE ANALYSIS</h3>
  <p style="opacity:0.7;font-size:0.85rem;">A partial disk image was recovered from Node 02 ‚Äî the patient zero machine. Inside the image is a hex dump of a suspicious file found in the temp directory. Hex dumps show the raw bytes of a file. You're looking for readable strings, known file signatures, and anything that shouldn't be there.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> File type signatures ‚Äî called "magic bytes" ‚Äî appear at the very start of a file's hex dump. <code>4D 5A</code> at offset 0x00 means Windows executable (.exe). Readable ASCII strings embedded in a binary file are often configuration data, C2 addresses, or attacker messages. Highlighted sections are worth your attention.
  </p>
  <br>
  <button id="img-btn" onclick="loadDiskImage()">‚ñ∂ MOUNT DISK IMAGE FRAGMENT</button>
  <div id="hex-wrap" class="hidden" style="margin-top:14px;"></div>
  <div id="img-questions" class="hidden" style="margin-top:14px;"></div>
  <p id="img-status" style="margin-top:10px;font-size:0.85rem;"></p>
</div>

<!-- PHASE 4 ‚Äî ROOT CAUSE -->
<div class="panel">
  <h3>PHASE 4 ‚Äî ROOT CAUSE ANALYSIS</h3>
  <p style="opacity:0.7;font-size:0.85rem;">Timeline reconstructed. Disk image analyzed. Now the final question: what was the single root cause that made this entire breach possible? Root cause isn't the most dramatic event ‚Äî it's the earliest failure that, if fixed, would have stopped everything that followed. Get this right and the Guild can build targeted defenses. Get it wrong and the door stays open.</p>
  <p style="opacity:0.6;font-size:0.82rem;margin-top:6px;border-left:2px solid #00ffcc44;padding-left:10px;">
    <strong style="color:#00ffcc;opacity:0.8;">HINT:</strong> Look at what you found in Phase 1 and 3. What was the very first thing Asher needed to succeed? If that single thing had been prevented ‚Äî better user training, a patched vulnerability, a stricter email filter ‚Äî would the rest of the attack chain have been possible?
  </p>
  <div class="answer-grid" id="rca-grid" style="margin-top:14px;"></div>
  <p id="rca-status" style="margin-top:10px;font-size:0.85rem;"></p>
</div>

<div class="log" id="log">
  <p class="info">// LAB 5 INITIALIZED ‚Äî FORENSIC ANALYSIS MODULE LOADED</p>
  <p class="info">// Evidence integrity: 70% ‚Äî Artifacts queued for examination</p>
</div>

<div class="panel hidden" id="complete-panel" style="box-shadow:0 0 24px rgba(0,255,204,0.6);">
  <h3 style="font-size:1.4rem;">‚úÖ LAB 5 COMPLETE ‚Äî INVESTIGATION CLOSED</h3>
  <p>Attack timeline verified. Root cause confirmed. Forensic report submitted to the Guild.</p>
  <p style="color:#888;font-size:0.85rem;">But the disk image held one more thing. Hidden at the end of the <code>byte_agent.bin</code> hex dump ‚Äî appended after the program data ‚Äî a string that wasn't part of the malware: <em>"DARWIN_KEY_FRAGMENT_2 // vault-node-cache // they will look for this in the wrong place"</em>. Darwin didn't just leave a message. He left a piece of something. And Asher's code was carrying it without knowing.</p>
  <p><strong>SKILLS EARNED:</strong> Artifact Analysis ¬∑ Forensic Timeline ¬∑ Hex/Disk Examination ¬∑ Root Cause Analysis</p>
  <p><strong>CAREER RELEVANCE:</strong> SOC Tier 2 ¬∑ Digital Forensics Analyst ¬∑ Incident Investigator</p>
  <br>
  <div style="display:flex;gap:14px;flex-wrap:wrap;margin-top:8px;">
    <a href="s1-lab6.html"><button>‚Üí PROCEED TO LAB 6</button></a>
    <a href="defenders-dashboard.html"><button style="border-color:#555;color:#888;">‚åÇ BACK TO DASHBOARD</button></a>
  </div>
</div>

<script>
const narrative=`> DEFENDERS GUILD ‚Äî BOOTLOADER v1.0\n> Forensic module: ONLINE\n> Quarantine artifacts: 4 recovered\n> Patient zero disk image: PARTIAL ‚Äî 62% readable\n> Darwin fragment detected in artifact data\n> Defender ‚Äî reconstruct the truth.`;
let ci=0;const be=document.getElementById('boot-text');
function typeIt(){if(ci<narrative.length){be.textContent+=narrative[ci++];setTimeout(typeIt,28);}else{be.classList.remove('typing-cursor');initLab();}}
typeIt();

// EVIDENCE INTEGRITY
let ei=70;
function setEI(v){
  ei=Math.max(0,Math.min(100,v));
  document.getElementById('ei-pct').textContent=ei+'%';
  document.getElementById('ei-bar').style.width=ei+'%';
  const bar=document.getElementById('ei-bar'),lbl=document.getElementById('ei-label');
  if(ei>=60){bar.classList.remove('low');lbl.style.color='#00ffcc';lbl.textContent='‚úì ADMISSIBLE';}
  else{bar.classList.add('low');lbl.style.color='#ff4444';lbl.textContent='‚ö† INTEGRITY COMPROMISED';}
}

const phases={p1:false,p2:false,p3:false,p4:false};
function updatePB(){const d=Object.values(phases).filter(Boolean).length;document.getElementById('pb').style.width=(d/4*100)+'%';if(d===4)setTimeout(showComplete,600);}
function lg(m,c=''){const l=document.getElementById('log');const p=document.createElement('p');if(c)p.className=c;p.textContent=m;l.appendChild(p);l.scrollTop=l.scrollHeight;}
function cookie(m){document.getElementById('cookie-text').textContent=m;}

// PHASE 1 ‚Äî ARTIFACTS
const artifacts=[
  {id:'a1',title:'EMAIL LOG ‚Äî 08:14:32',detail:'Inbound message to vault-user@guild.net from external domain. Attachment: project_update.zip. No SPF/DKIM validation. User opened attachment at 08:17.',correct:'INITIAL ACCESS',options:['INITIAL ACCESS','EXECUTION','PERSISTENCE','EXFILTRATION']},
  {id:'a2',title:'PROCESS LOG ‚Äî 08:19:05',detail:'byte_agent.bin spawned from %TEMP%\\project_update\\. Parent: outlook.exe. Immediately wrote to registry HKCU\\Software\\Run. Network connection initiated within 4 seconds.',correct:'EXECUTION',options:['INITIAL ACCESS','EXECUTION','PERSISTENCE','EXFILTRATION']},
  {id:'a3',title:'REGISTRY SNAPSHOT ‚Äî 08:19:09',detail:'New key written: HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\svc_update ‚Üí C:\\Windows\\Temp\\svchost_update.exe. Survives reboot. Written by byte_agent.bin.',correct:'PERSISTENCE',options:['INITIAL ACCESS','EXECUTION','PERSISTENCE','EXFILTRATION']},
  {id:'a4',title:'NETWORK LOG ‚Äî 08:44:17',detail:'Sustained outbound transfer: Node02 ‚Üí 203.0.113.44:443. 847 packets. 2.3MB transferred. Destination not on allowlist. Transfer ceased only after firewall rule applied in Lab 4.',correct:'EXFILTRATION',options:['INITIAL ACCESS','EXECUTION','PERSISTENCE','EXFILTRATION']},
];
let artTagged={};
function initLab(){
  buildArtifacts();
  buildTimeline();
  buildRCA();
  cookie('Four artifacts recovered. Tag each one ‚Äî what phase of the attack does it represent?');
}
function buildArtifacts(){
  const wrap=document.getElementById('artifact-list');
  artifacts.forEach(a=>{
    const d=document.createElement('div');d.className='artifact-card';d.id='art-'+a.id;
    d.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:8px;">
      <div><strong>${a.title}</strong><div class="meta">${a.detail}</div></div>
      <select id="sel-${a.id}" onchange="tagArtifact('${a.id}',this.value)" style="background:#000;border:1px solid #00ffcc33;color:#00ffcc;font-family:monospace;font-size:0.8rem;padding:5px 8px;border-radius:3px;min-width:140px;">
        <option value="">-- TAG AS --</option>
        ${a.options.map(o=>`<option value="${o}">${o}</option>`).join('')}
      </select>
    </div>`;
    wrap.appendChild(d);
  });
}
function tagArtifact(id,val){
  if(!val)return;
  const art=artifacts.find(a=>a.id===id);
  const card=document.getElementById('art-'+id);
  artTagged[id]=val;
  if(val===art.correct){
    card.classList.remove('wrong');card.classList.add('correct');
    lg(`> Artifact tagged correctly: ${art.title} ‚Üí ${val}`,'success');
    setEI(ei+3);
  } else {
    card.classList.remove('correct');card.classList.add('wrong');
    lg(`> Incorrect tag: ${art.title} ‚Äî re-examine the evidence`,'warn');
    setEI(ei-5);
  }
  if(Object.keys(artTagged).length===artifacts.length){
    const allCorrect=artifacts.every(a=>artTagged[a.id]===a.correct);
    const correct=artifacts.filter(a=>artTagged[a.id]===a.correct).length;
    const st=document.getElementById('artifact-status');
    if(correct>=3){
      st.innerHTML=`<span style="color:#00ffcc;">‚úì ${correct}/4 artifacts correctly tagged. Phase 1 complete.</span>`;
      phases.p1=true;updatePB();
      cookie('Good reads. The email log is your Initial Access ‚Äî that\'s where this whole chain started.');
      lg('> Phase 1 complete. Artifact examination logged.','success');
    } else {
      st.innerHTML=`<span style="color:#ffaa00;">‚ö† ${correct}/4 correct. Re-examine mistagged artifacts before moving on.</span>`;
    }
  }
}

// PHASE 2 ‚Äî TIMELINE
const tlEvents=[
  {t:'PHISHING EMAIL ‚Äî User opens malicious attachment project_update.zip from unverified sender',pos:1},
  {t:'MALWARE EXECUTION ‚Äî byte_agent.bin runs from temp directory, spawned by outlook.exe',pos:2},
  {t:'CREDENTIAL HARVEST ‚Äî byte_agent.bin dumps cached NTLM hashes from memory',pos:3},
  {t:'LATERAL MOVEMENT ‚Äî Stolen credentials used to authenticate to Node 03 and Node 05 via SMB',pos:4},
  {t:'PERSISTENCE INSTALLED ‚Äî svchost_update.exe written to registry autorun on all compromised nodes',pos:5},
];
let tlShuffled=[],tlSel=[];
function buildTimeline(){
  tlShuffled=[...tlEvents].sort(()=>Math.random()-0.5);tlSel=[];
  const w=document.getElementById('timeline-wrap');
  w.innerHTML='<p style="font-size:0.78rem;opacity:0.6;margin-bottom:8px;">Click events in the order they occurred ‚Äî first click = earliest event:</p>';
  tlShuffled.forEach((e,i)=>{
    const b=document.createElement('div');b.className='artifact-card';b.id='tl'+i;
    b.innerHTML=`<span id="tlnum${i}" style="color:#555;margin-right:8px;">[?]</span>${e.t}`;
    b.onclick=()=>selectTL(i,b,e);
    w.appendChild(b);
  });
}
function selectTL(i,el,e){
  if(tlSel.find(x=>x.i===i))return;
  tlSel.push({i,pos:e.pos});
  el.classList.add('selected');
  document.getElementById('tlnum'+i).textContent=`[${tlSel.length}]`;
  document.getElementById('tlnum'+i).style.color='#ffaa00';
}
function verifyTimeline(){
  let ok=0;
  tlSel.forEach((x,idx)=>{if(x.pos===idx+1)ok++;});
  const st=document.getElementById('tl-status');
  if(ok>=4){
    tlSel.forEach((x,idx)=>{
      const el=document.getElementById('tl'+x.i);
      el.classList.remove('selected');
      el.classList.add(x.pos===idx+1?'correct':'wrong');
    });
    st.innerHTML='<span style="color:#00ffcc;">‚úì Timeline verified. Attack sequence confirmed. Phase 2 complete.</span>';
    phases.p2=true;updatePB();setEI(ei+8);
    lg('> Phase 2 complete. Attack timeline locked.','success');
    cookie('Timeline confirmed. Phishing first, persistence last. Classic Asher ‚Äî predictable once you know his playbook.');
    document.getElementById('img-btn').disabled=false;
  } else {
    st.innerHTML=`<span style="color:#ffaa00;">‚ö† ${ok}/5 correct. Think about what had to come before each step ‚Äî then retry.</span>`;
    setEI(ei-6);
    lg('> Timeline inconsistency ‚Äî re-examine event sequence','warn');
    cookie('Something\'s out of order. Think about what each step requires to be possible first.');
    buildTimeline();
  }
}

// PHASE 3 ‚Äî DISK IMAGE
function loadDiskImage(){
  document.getElementById('img-btn').disabled=true;
  lg('> Mounting disk image fragment from Node 02...');
  cookie('Read the hex carefully. Magic bytes at the start tell you the file type. Look for readable strings embedded in the binary.');
  setTimeout(()=>{
    lg('> Image mounted. Suspicious file recovered: byte_agent.bin (80KB)','success');
    document.getElementById('hex-wrap').classList.remove('hidden');
    document.getElementById('hex-wrap').innerHTML=`
    <p style="font-size:0.78rem;opacity:0.6;margin-bottom:6px;">HEX DUMP ‚Äî byte_agent.bin (first 512 bytes + tail)</p>
    <div class="hex-block">Offset    Hex                                       ASCII
0x0000    <span class="hl">4D 5A</span> 90 00 03 00 00 00 04 00   <span class="hl">MZ</span>........
0x0010    FF FF 00 00 B8 00 00 00 00 00   ..........
0x0020    40 00 00 00 00 00 00 00 00 00   @.........
0x0080    50 45 00 00 4C 01 04 00 A2 3F   PE..L....?
0x00C0    00 00 00 00 00 00 E0 00 0F 01   ..........
<span class="hl">0x0140    43 32 5F 48 4F 53 54 3A 20 32   C2_HOST: 2</span>
<span class="hl">0x014A    30 33 2E 30 2E 31 31 33 2E 34   03.0.113.4</span>
<span class="hl">0x0154    34 3A 34 34 33 00 00 00 00 00   4:443.......</span>
0x0200    41 53 48 45 52 2D 4D 55 54 2D   ASHER-MUT-
0x020A    30 78 33 41 00 00 00 00 00 00   0x3A......
0x0300    [... 79KB of packed executable data ...]
<span class="hl">0xFF80    44 41 52 57 49 4E 5F 4B 45 59   DARWIN_KEY</span>
<span class="hl">0xFF8A    5F 46 52 41 47 4D 45 4E 54 5F   _FRAGMENT_</span>
<span class="hl">0xFF94    32 20 2F 2F 20 76 61 75 6C 74   2 // vault</span>
<span class="hl">0xFF9E    2D 6E 6F 64 65 2D 63 61 63 68   -node-cach</span>
<span class="hl">0xFFA8    65 00 00 00 00 00 00 00 00 00   e........</span></div>`;
    setTimeout(()=>{
      document.getElementById('img-questions').classList.remove('hidden');
      buildImgQuestions();
    },600);
  },1400);
}
let imgAnswers={},imgDone=false;
const imgQs=[
  {id:'iq1',q:'What type of file is this based on the magic bytes at offset 0x0000?',options:['Windows Executable (.exe)','PDF Document','ZIP Archive','Linux ELF Binary'],correct:0},
  {id:'iq2',q:'What does the readable string at offset 0x0140 reveal?',options:['The attacker\'s username','The C2 server address and port','A file path on the target machine','An encryption key'],correct:1},
  {id:'iq3',q:'What is the significance of the data found at offset 0xFF80?',options:['It\'s standard program metadata','It\'s a compiler signature','It\'s appended data ‚Äî not part of the original program','It\'s an error log from the infection'],correct:2},
];
function buildImgQuestions(){
  const wrap=document.getElementById('img-questions');
  wrap.innerHTML='<p style="font-size:0.85rem;margin-bottom:10px;">Answer the following based on what you see in the hex dump:</p>';
  imgQs.forEach(q=>{
    const d=document.createElement('div');d.style.cssText='margin:14px 0;';
    d.innerHTML=`<p style="font-size:0.85rem;margin-bottom:8px;"><strong>${q.q}</strong></p>
    <div style="display:flex;flex-direction:column;gap:6px;" id="opts-${q.id}">
      ${q.options.map((o,i)=>`<button style="text-align:left;font-size:0.82rem;" onclick="answerImg('${q.id}',${i},${q.correct})">${o}</button>`).join('')}
    </div>
    <p id="fb-${q.id}" style="font-size:0.82rem;margin-top:6px;"></p>`;
    wrap.appendChild(d);
  });
}
function answerImg(qid,chosen,correct){
  if(imgAnswers[qid]!==undefined)return;
  imgAnswers[qid]=chosen;
  const btns=document.getElementById('opts-'+qid).querySelectorAll('button');
  btns.forEach(b=>b.disabled=true);
  const fb=document.getElementById('fb-'+qid);
  if(chosen===correct){
    btns[chosen].style.borderColor='#00ffcc';btns[chosen].style.color='#00ffcc';
    fb.innerHTML='<span style="color:#00ffcc;">‚úì Correct.</span>';
    setEI(ei+4);lg(`> Hex analysis correct: question ${Object.keys(imgAnswers).length}`,'success');
  } else {
    btns[chosen].style.borderColor='#ff4444';btns[chosen].style.color='#ff4444';
    btns[correct].style.borderColor='#00ffcc';btns[correct].style.color='#00ffcc';
    fb.innerHTML='<span style="color:#ffaa00;">‚ö† Incorrect ‚Äî correct answer highlighted.</span>';
    setEI(ei-5);lg('> Hex misread ‚Äî evidence integrity reduced','warn');
  }
  if(Object.keys(imgAnswers).length===imgQs.length&&!imgDone){
    imgDone=true;
    const score=imgQs.filter(q=>imgAnswers[q.id]===q.options.indexOf(q.options[q.correct])||imgAnswers[q.id]===q.correct).length;
    setTimeout(()=>{
      document.getElementById('img-status').innerHTML='<span style="color:#00ffcc;">‚úì Disk image analysis complete. Phase 3 complete.</span>';
      phases.p3=true;updatePB();
      lg('> Phase 3 complete. Disk image analysis logged.','success');
      cookie('You found the Darwin fragment. It was appended to Asher\'s own malware. He was carrying Darwin\'s data without knowing it.');
    },400);
  }
}

// PHASE 4 ‚Äî ROOT CAUSE
const rcaOptions=[
  {text:'A phishing email that bypassed email filtering and was opened by a user with no security awareness training',correct:true,feedback:'Correct. The phishing email was the first failure in the chain. Stronger email filtering and user training would have stopped everything that followed.'},
  {text:'A zero-day vulnerability in the Windows kernel that Asher exploited before a patch was available',correct:false,feedback:'No zero-day was found in the evidence. byte_agent.bin was a dropper delivered via email ‚Äî no kernel exploit involved.'},
  {text:'A misconfigured firewall that allowed SMB traffic between subnets that should have been segmented',correct:false,feedback:'The firewall gaps made lateral movement easier ‚Äî but the breach started before the Byte Bugs reached the network. Fixing the firewall wouldn\'t have stopped the initial infection.'},
  {text:'Weak credentials on Node 02 that allowed the attacker to authenticate without needing stolen hashes',correct:false,feedback:'Credential weakness was a factor ‚Äî but the breach started with the phishing email. Without that initial execution, there were no credentials to steal.'},
];
function buildRCA(){
  const grid=document.getElementById('rca-grid');
  rcaOptions.forEach((o,i)=>{
    const b=document.createElement('button');
    b.className='answer-btn';b.style.width='100%';
    b.textContent=o.text;
    b.onclick=()=>answerRCA(i,b,o);
    grid.appendChild(b);
  });
}
let rcaDone=false;
function answerRCA(i,btn,opt){
  if(rcaDone)return;
  Array.from(document.getElementById('rca-grid').children).forEach(b=>b.disabled=true);
  const st=document.getElementById('rca-status');
  if(opt.correct){
    rcaDone=true;
    btn.style.borderColor='#00ffcc';btn.style.color='#00ffcc';
    st.innerHTML=`<span style="color:#00ffcc;">‚úì ${opt.feedback} Phase 4 complete.</span>`;
    phases.p4=true;updatePB();setEI(ei+6);
    lg('> Root cause confirmed: phishing via unfiltered email + untrained user.','success');
    cookie('Phishing is the root cause of more than 90% of breaches. Fix the front door and half of Asher\'s playbook disappears.');
  } else {
    btn.style.borderColor='#ff4444';btn.style.color='#ff4444';
    st.innerHTML=`<span style="color:#ffaa00;">‚ö† ${opt.feedback} Review your artifact and timeline findings and try again.</span>`;
    setEI(ei-8);
    lg('> Incorrect root cause ‚Äî review evidence chain','warn');
    cookie('That\'s not what the evidence shows. Go back to your artifacts ‚Äî what was the very first thing that gave Asher a foothold?');
    setTimeout(()=>Array.from(document.getElementById('rca-grid').children).forEach(b=>b.disabled=false),1000);
  }
}

function showComplete(){
  document.getElementById('complete-panel').classList.remove('hidden');
  document.getElementById('complete-panel').scrollIntoView({behavior:'smooth'});
  lg('>>> LAB 5 COMPLETE. FORENSIC INVESTIGATION CLOSED. <<<','success');
  cookie('Lab 5 done. The truth is on record. And that Darwin key fragment ‚Äî that\'s the second piece. Keep it safe.');
}
</script>
</body>
</html>
